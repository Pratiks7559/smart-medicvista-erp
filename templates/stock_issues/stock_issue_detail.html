{% extends 'base.html' %}
{% load static %}

{% block title %}Stock Issue {{ issue.issue_no }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/stock_issue_detail.css' %}">
{% endblock %}

{% block content %}
<div class="sid-main-container">
    <div class="sid-header-wrapper">
        <div class="sid-page-title-section">
            <h1 class="sid-main-heading"><i class="fas fa-minus-circle sid-heading-icon"></i> Stock Issue {{ issue.issue_no }}</h1>
            <p class="sid-page-description">View stock issue details and affected inventory</p>
        </div>
        <div class="sid-header-actions-group">
            <a href="{% url 'stock_issue_list' %}" class="sid-btn sid-btn-secondary">
                <i class="fas fa-arrow-left sid-btn-icon"></i> Back to List
            </a>
            <a href="{% url 'delete_stock_issue' issue.issue_id %}" class="sid-btn sid-btn-danger">
                <i class="fas fa-trash sid-btn-icon"></i> Delete Issue
            </a>
        </div>
    </div>

    <div class="sid-content-sections">
        <!-- Issue Information -->
        <div class="sid-info-section">
            <h3 class="sid-section-title"><i class="fas fa-info-circle sid-section-icon"></i> Issue Information</h3>
            <div class="sid-info-grid">
                <div class="sid-info-item">
                    <label class="sid-info-label">Issue Number:</label>
                    <span class="sid-info-value">{{ issue.issue_no }}</span>
                </div>
                <div class="sid-info-item">
                    <label class="sid-info-label">Issue Date:</label>
                    <span class="sid-info-value">{{ issue.issue_date|date:"d-m-Y" }}</span>
                </div>
                <div class="sid-info-item">
                    <label class="sid-info-label">Issue Type:</label>
                    <span class="sid-info-value">
                        <span class="sid-type-badge sid-type-{{ issue.issue_type }}">
                            {{ issue.get_issue_type_display }}
                        </span>
                    </span>
                </div>
                <div class="sid-info-item">
                    <label class="sid-info-label">Total Value:</label>
                    <span class="sid-info-value sid-total-amount">₹{{ issue.total_value|floatformat:2 }}</span>
                </div>
                <div class="sid-info-item">
                    <label class="sid-info-label">Created By:</label>
                    <span class="sid-info-value">{{ issue.created_by.get_full_name|default:issue.created_by.username }}</span>
                </div>
                <div class="sid-info-item">
                    <label class="sid-info-label">Created At:</label>
                    <span class="sid-info-value">{{ issue.created_at|date:"d-m-Y H:i" }}</span>
                </div>
                {% if issue.remarks %}
                <div class="sid-info-item sid-full-width">
                    <label class="sid-info-label">Remarks:</label>
                    <span class="sid-info-value">{{ issue.remarks }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Issue Details -->
        <div class="sid-details-section">
            <h3 class="sid-section-title"><i class="fas fa-list sid-section-icon"></i> Issue Details</h3>
            {% if details %}
                <div class="sid-table-wrapper">
                    <table class="sid-details-table">
                        <thead class="sid-table-header">
                            <tr class="sid-header-row">
                                <th class="sid-th sid-th-product">Product</th>
                                <th class="sid-th sid-th-batch">Batch No</th>
                                <th class="sid-th sid-th-expiry">Expiry</th>
                                <th class="sid-th sid-th-quantity">Quantity Issued</th>
                                <th class="sid-th sid-th-rate">Unit Rate</th>
                                <th class="sid-th sid-th-amount">Total Amount</th>
                                <th class="sid-th sid-th-remarks">Remarks</th>
                            </tr>
                        </thead>
                        <tbody class="sid-table-body">
                            {% for detail in details %}
                                <tr class="sid-detail-row">
                                    <td class="sid-td sid-product-cell">
                                        <div class="sid-product-name">{{ detail.product.product_name }}</div>
                                        <div class="sid-product-meta">
                                            {{ detail.product.product_company }} - {{ detail.product.product_packing }}
                                        </div>
                                    </td>
                                    <td class="sid-td sid-batch-cell">{{ detail.batch_no }}</td>
                                    <td class="sid-td sid-expiry-cell">{{ detail.expiry_date }}</td>
                                    <td class="sid-td sid-quantity-cell">{{ detail.quantity_issued|floatformat:2 }}</td>
                                    <td class="sid-td sid-rate-cell">₹{{ detail.unit_rate|floatformat:2 }}</td>
                                    <td class="sid-td sid-amount-cell">₹{{ detail.total_amount|floatformat:2 }}</td>
                                    <td class="sid-td sid-remarks-cell">{{ detail.remarks|default:"-" }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="sid-table-footer">
                            <tr class="sid-total-row">
                                <td class="sid-td sid-total-label" colspan="5"><strong>Total:</strong></td>
                                <td class="sid-td sid-total-value"><strong>₹{{ issue.total_value|floatformat:2 }}</strong></td>
                                <td class="sid-td"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            {% else %}
                <div class="sid-empty-state">
                    <div class="sid-empty-icon">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <h4 class="sid-empty-title">No Items Found</h4>
                    <p class="sid-empty-text">This stock issue has no items recorded.</p>
                </div>
            {% endif %}
        </div>

        <!-- Summary Statistics -->
        <div class="sid-summary-section">
            <h3 class="sid-section-title"><i class="fas fa-chart-bar sid-section-icon"></i> Summary</h3>
            <div class="sid-summary-grid">
                <div class="sid-summary-card">
                    <div class="sid-summary-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="sid-summary-content">
                        <div class="sid-summary-value">{{ details.count }}</div>
                        <div class="sid-summary-label">Total Items</div>
                    </div>
                </div>
                <div class="sid-summary-card">
                    <div class="sid-summary-icon">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="sid-summary-content">
                        <div class="sid-summary-value">
                            {% with details|length as unique_products %}{{ unique_products }}{% endwith %}
                        </div>
                        <div class="sid-summary-label">Unique Products</div>
                    </div>
                </div>
                <div class="sid-summary-card">
                    <div class="sid-summary-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="sid-summary-content">
                        <div class="sid-summary-value">
                            {% for detail in details %}
                                {% if forloop.first %}{{ detail.quantity_issued|floatformat:0 }}{% endif %}
                                {% if not forloop.first %}+{{ detail.quantity_issued|floatformat:0 }}{% endif %}
                            {% endfor %}
                        </div>
                        <div class="sid-summary-label">Total Quantity</div>
                    </div>
                </div>
                <div class="sid-summary-card">
                    <div class="sid-summary-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="sid-summary-content">
                        <div class="sid-summary-value">₹{{ issue.total_value|floatformat:2 }}</div>
                        <div class="sid-summary-label">Total Value</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}