{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/customer_challan_detail.css' %}">
{% endblock %}

{% block content %}
<div class="cust-chal-detail-container">
    <div class="cust-chal-detail-wrapper">
        <div class="cust-chal-detail-card">
            <!-- Header -->
            <div class="cust-chal-detail-header">
                <div class="header-left">
                    <h4 class="chal-title">Customer Challan Details</h4>
                    <span class="chal-number">{{ challan.customer_challan_no }}</span>
                </div>
                <div class="header-right">
                    <a href="{% url 'customer_challan_list' %}" class="chal-back-btn">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                </div>
            </div>

            <!-- Challan Info -->
            <div class="cust-chal-info-section">
                <div class="info-row">
                    <div class="info-col">
                        <label class="info-label">Challan Number</label>
                        <div class="info-value">{{ challan.customer_challan_no }}</div>
                    </div>
                    <div class="info-col">
                        <label class="info-label">Challan Date</label>
                        <div class="info-value">{{ challan.customer_challan_date|date:"d-m-Y" }}</div>
                    </div>
                    <div class="info-col">
                        <label class="info-label">Customer Name</label>
                        <div class="info-value">{{ challan.customer_name.customer_name }}</div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-col">
                        <label class="info-label">Series</label>
                        <div class="info-value">{{ challan.challan_series.series_name|default:"N/A" }}</div>
                    </div>
                    <div class="info-col">
                        <label class="info-label">Transport Charges</label>
                        <div class="info-value">₹{{ challan.customer_transport_charges|floatformat:2 }}</div>
                    </div>
                    <div class="info-col">
                        <label class="info-label">Created At</label>
                        <div class="info-value">{{ challan.created_at|date:"d-m-Y H:i" }}</div>
                    </div>
                </div>
            </div>

            <!-- Products Table -->
            <div class="cust-chal-products-section">
                <h5 class="section-title">Products</h5>
                <div class="products-table-wrapper">
                    <table class="chal-products-table">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Product Name</th>
                                <th>Company</th>
                                <th>Batch No</th>
                                <th>Expiry</th>
                                <th>MRP</th>
                                <th>Rate</th>
                                <th>Qty</th>
                                <th>Discount</th>
                                <th>CGST%</th>
                                <th>SGST%</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in challan_items %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td class="product-name-col">{{ item.product_name }}</td>
                                <td>{{ item.product_company }}</td>
                                <td>{{ item.product_batch_no }}</td>
                                <td>{{ item.product_expiry }}</td>
                                <td>₹{{ item.product_mrp|floatformat:2 }}</td>
                                <td>₹{{ item.sale_rate|floatformat:2 }}</td>
                                <td>{{ item.sale_quantity|floatformat:2 }}</td>
                                <td>₹{{ item.sale_discount|floatformat:2 }}</td>
                                <td>{{ item.sale_cgst|floatformat:2 }}%</td>
                                <td>{{ item.sale_sgst|floatformat:2 }}%</td>
                                <td class="total-col">₹{{ item.sale_total_amount|floatformat:2 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="12" class="no-data">No products found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            {% if challan.customer_transport_charges > 0 %}
                            <tr class="subtotal-row">
                                <td colspan="11" class="subtotal-label">Subtotal:</td>
                                <td class="subtotal-value">₹{{ grand_total|floatformat:2 }}</td>
                            </tr>
                            <tr class="transport-row">
                                <td colspan="11" class="transport-label">Transport Charges:</td>
                                <td class="transport-value">₹{{ challan.customer_transport_charges|floatformat:2 }}</td>
                            </tr>
                            <tr class="total-row">
                                <td colspan="11" class="total-label">Grand Total:</td>
                                <td class="grand-total">₹{{ final_total|floatformat:2 }}</td>
                            </tr>
                            {% else %}
                            <tr class="total-row">
                                <td colspan="11" class="total-label">Grand Total:</td>
                                <td class="grand-total">₹{{ grand_total|floatformat:2 }}</td>
                            </tr>
                            {% endif %}
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
