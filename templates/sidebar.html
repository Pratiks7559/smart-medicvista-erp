{% load static %}
<link rel="stylesheet" href="{% static 'css/sidebar.css' %}?v=1.1">
<script src="{% static 'js/sidebar.js' %}?v=1.1"></script>

<style>
.sidebar-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
    box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1) !important;
}

.sidebar-content {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px) !important;
}

.nav-link, .nav-menu-button {
    color: rgba(255, 255, 255, 0.9) !important;
}

.nav-link:hover, .nav-menu-button:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    color: white !important;
}

.user-name, .user-type {
    color: white !important;
}
</style>
<!-- Modern Sidebar -->
<aside class="sidebar-container" id="sidebar">
    <div class="sidebar-content">

        <!-- User Profile Section -->
        <div class="user-profile-section">
            {% if user.is_authenticated %}
            <div class="user-profile-content">
                <div class="user-avatar">
                    {% if user.path %}
                        <img src="{{ user.path.url }}" alt="{{ user.get_full_name|default:user.username }}" class="profile-picture">
                    {% else %}
                        <div class="default-logo">
                            <i class="fas fa-capsules"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="user-info">
                    <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                    <div class="user-type">{{ user.user_type|title }}</div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Navigation Menu -->
        <nav class="nav-menu">
            <ul>
                <!-- Dashboard -->
                <!-- <li>
                    <a href="{% url 'dashboard' %}" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li> -->
                
                <!-- Purchases Menu -->
                <li class="nav-item">
                    <button type="button" class="nav-menu-button" onclick="toggleSubmenu('purchaseSubmenu')" aria-expanded="false" aria-controls="purchaseSubmenu">
                        <div class="nav-button-content">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="nav-text">Purchases</span>
                        </div>
                        <i class="fas fa-angle-down nav-arrow"></i>
                    </button>
                    <ul id="purchaseSubmenu" class="submenu hidden">
                        <li>
                            <a href="{% url 'supplier_challan_list' %}" class="nav-submenu-link" style="text-decoration: none;" id="purchaseChallanLink">
                                <i class="fas fa-file-alt"></i>
                                <span class="nav-text">Purchase Challan</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'add_invoice_with_products' %}" class="nav-submenu-link" style="text-decoration: none;" id="newPurchaseInvoiceLink">
                                <i class="fas fa-plus"></i>
                                <span class="nav-text">New Invoice</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'invoice_list' %}" class="nav-submenu-link" style="text-decoration: none;" id="purchaseInvoiceListLink">
                                <i class="fas fa-file-invoice"></i>
                                <span class="nav-text">Invoices</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'supplier_list' %}" class="nav-submenu-link" style="text-decoration: none;" id="suppliersLink">
                                <i class="fas fa-truck"></i>
                                <span class="nav-text">Suppliers</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'purchase_return_list' %}" class="nav-submenu-link" style="text-decoration: none;" id="purchaseReturnLink">
                                <i class="fas fa-undo"></i>
                                <span class="nav-text">Purchase Return</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'add_unified_payment' %}" class="nav-submenu-link" style="text-decoration: none; color: #a3d2ae;" id="purchasePaymentLink">
                                <i class="fas fa-money-check-alt"></i>
                                <span class="nav-text">Payment</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Sales Menu -->
                <li class="nav-item">
                    <button type="button" class="nav-menu-button" onclick="toggleSubmenu('salesSubmenu')" aria-expanded="false" aria-controls="salesSubmenu">
                        <div class="nav-button-content">
                            <i class="fas fa-cash-register"></i>
                            <span class="nav-text">Sales</span>
                        </div>
                        <i class="fas fa-angle-down nav-arrow"></i>
                    </button>
                    <ul id="salesSubmenu" class="submenu hidden">
                        <li>
                            <a href="{% url 'customer_challan_list' %}" class="nav-submenu-link" style="text-decoration: none;" id="salesChallanLink">
                                <i class="fas fa-file-alt"></i>
                                <span class="nav-text">sales Challan</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'add_sales_invoice_with_products' %}" id="quickInvoiceLink" class="nav-submenu-link"style="text-decoration: none;">
                                <i class="fas fa-plus"></i>
                                <span class="nav-text">New Invoice</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'sales_invoice_list' %}" class="nav-submenu-link"style="text-decoration: none;" id="salesInvoiceListLink">
                                <i class="fas fa-file-invoice-dollar"></i>
                                <span class="nav-text">Invoices</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'customer_list' %}" class="nav-submenu-link" style="text-decoration: none;" id="customersLink">
                                <i class="fas fa-users"></i>
                                <span class="nav-text">Customers</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'sales_return_list' %}" class="nav-submenu-link" style="text-decoration: none;" id="salesReturnLink">
                                <i class="fas fa-undo-alt"></i>
                                <span class="nav-text">Sales Return</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'add_unified_payment' %}" class="nav-submenu-link" style="text-decoration: none; color: #8ac397;" id="salesReceiptLink">
                                <i class="fas fa-money-check-alt"></i>
                                <span class="nav-text">Receipt</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'stock_issue_list' %}" class="nav-submenu-link" role="menuitem" style="text-decoration: none; color: #d0a2a2;" id="stockIssuesLink">
                                <i class="fas fa-minus-circle"></i>
                                <span class="nav-text">Stock Issues</span>
                            </a>
                        </li>
                    </ul>
                </li>
                

                
                <!-- Enhanced Inventory Menu -->
                <li class="nav-item" role="none">
                    <button type="button" class="nav-menu-button" onclick="toggleSubmenu('inventorySubmenu')" aria-expanded="false" aria-controls="inventorySubmenu" role="menuitem">
                        <div class="nav-button-content">
                            <i class="fas fa-boxes"></i>
                            <span class="nav-text">Inventory</span>
                        </div>
                        <i class="fas fa-angle-down nav-arrow"></i>
                    </button>
                    <ul id="inventorySubmenu" class="submenu hidden" role="menu">
                        <li role="none">
                            <a href="{% url 'product_list' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="productListLink">
                                <i class="fas fa-pills"></i>
                                <span class="nav-text">Product List</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'inventory_list' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="allInventoryLink">
                                <i class="fas fa-list"></i>
                                <span class="nav-text">All Products Inventory</span>
                            </a>
                        </li>
                        <li role="none" style="display: none;">
                            <a href="{% url 'low_stock_update' %}" class="nav-submenu-link" role="menuitem" style="text-decoration: none; color: #e7cba1;">
                                <i class="fas fa-plus-circle"></i>
                                <span class="nav-text">Update Low Stock</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'batch_inventory_report' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="batchReportLink">
                                <i class="fas fa-layer-group"></i>
                                <span class="nav-text">Batch-wise Report</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'dateexpiry_inventory_report' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="dateReportLink">
                                <i class="fas fa-calendar-alt"></i>
                                <span class="nav-text">Date-wise Report</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'stock_statement_report' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="stockStatementLink">
                                <i class="fas fa-warehouse"></i>
                                <span class="nav-text">Stock Statement</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Enhanced Reports Menu -->
                <li class="nav-item" role="none">
                    <button type="button" class="nav-menu-button" onclick="toggleSubmenu('reportsSubmenu')" aria-expanded="false" aria-controls="reportsSubmenu" role="menuitem">
                        <div class="nav-button-content">
                            <i class="fas fa-chart-bar"></i>
                            <span class="nav-text">Reports</span>
                        </div>
                        <i class="fas fa-angle-down nav-arrow"></i>
                    </button>
                    <ul id="reportsSubmenu" class="submenu hidden" role="menu">
                        <li role="none">
                            <a href="{% url 'sales2_report' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;">
                                <i class="fas fa-file-invoice-dollar"></i>
                                <span class="nav-text">Sales</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'customer_wise_sales_report' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;">
                                <i class="fas fa-user-tag"></i>
                                <span class="nav-text">Customer Wise Sales</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'purchase2_report' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="nav-text">Purchases</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'financial_report' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;">
                                <i class="fas fa-coins"></i>
                                <span class="nav-text">Financial</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'ledger_selection' %}" class="nav-submenu-link" role="menuitem" style="text-decoration: none;">
                                <i class="fas fa-book"></i>
                                <span class="nav-text">Ledger</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Enhanced Admin Menu (Conditional) -->
                {% if user.user_type == 'admin' %}
                <li class="nav-item" role="none">
                    <button type="button" class="nav-menu-button" onclick="toggleSubmenu('adminSubmenu')" aria-expanded="false" aria-controls="adminSubmenu" role="menuitem">
                        <div class="nav-button-content">
                            <i class="fas fa-cog"></i>
                            <span class="nav-text">Admin</span>
                        </div>
                        <i class="fas fa-angle-down nav-arrow"></i>
                    </button>
                    <ul id="adminSubmenu" class="submenu hidden" role="menu">
                        <li role="none">
                            <a href="{% url 'dashboard' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="dashboardLink">
                                <i class="fas fa-tachometer-alt"></i>
                                <span class="nav-text">Dashboard</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'register' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="addUserLink">
                                <i class="fas fa-user-plus"></i>
                                <span class="nav-text">Add User</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'pharmacy_details' %}" class="nav-submenu-link" role="menuitem"style="text-decoration: none;" id="pharmacyDetailsLink">
                                <i class="fas fa-clinic-medical"></i>
                                <span class="nav-text">Pharmacy Details</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'backup_list' %}" class="nav-submenu-link" role="menuitem" style="text-decoration: none; color: #8bd18e;" id="backupLink">
                                <i class="fas fa-database"></i>
                                <span class="nav-text">Database Backup</span>
                            </a>
                        </li>
                        <li role="none">
                            <a href="{% url 'add_unified_payment' %}" class="nav-submenu-link" role="menuitem" style="text-decoration: none;">
                                <i class="fas fa-layer-group"></i>
                                <span class="nav-text">Bulk Payment</span>
                            </a>
                        </li>
                        <!-- ============================================ -->
                        <!-- CONTRA ENTRY MODULE - SIDEBAR LINK -->
                        <!-- ============================================ -->
                        <li role="none">
                            <a href="{% url 'contra_list' %}" class="nav-submenu-link" role="menuitem" style="text-decoration: none; color: #f9d89c;" id="contraEntryLink">
                                <i class="fas fa-exchange-alt"></i>
                                <span class="nav-text">Contra Entry</span>
                            </a>
                        </li>
                        <!-- ============================================ -->
                    </ul>
                </li>
                {% endif %}
            </ul>
        </nav>
        
        <!-- Footer with logout -->
        <div class="sidebar-footer">
            <div class="footer-content">
                <a href="{% url 'logout' %}" class="footer-link logout-link" title="Logout (Alt+L)" style="text-decoration: none;" id="logoutLink">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="nav-text">Logout</span>
                </a>
            </div>
        </div>
    </div>
</aside>
<script>
    document.addEventListener('keydown', function(e) {
        if (e.altKey && e.key === 'l') {
            e.preventDefault();
            document.getElementById('logoutLink').click();
        }
    });
    
    // Purchase Section Shortcuts
    let keySequence = [];
    let sequenceTimeout;
    
    document.addEventListener('keydown', function(e) {
        // Alt + P - Purchase Challan
        if (e.altKey && e.key.toLowerCase() === 'p' && !e.ctrlKey) {
            e.preventDefault();
            const link = document.getElementById('purchaseChallanLink');
            if (link) link.click();
            return;
        }
        
        // Alt + S - Sales Challan (single key)
        if (e.altKey && e.key.toLowerCase() === 's' && !e.ctrlKey && !e.shiftKey) {
            e.preventDefault();
            keySequence = ['s'];
            clearTimeout(sequenceTimeout);
            
            sequenceTimeout = setTimeout(() => {
                // If no second key pressed, open Sales Challan
                if (keySequence.length === 1 && keySequence[0] === 's') {
                    const link = document.getElementById('salesChallanLink');
                    if (link) link.click();
                }
                keySequence = [];
            }, 800);
            
            // Wait for second key
            const secondKeyHandler = function(e2) {
                if (e2.altKey && e2.key.toLowerCase() === 'u') {
                    // Alt+S+U - Suppliers
                    e2.preventDefault();
                    clearTimeout(sequenceTimeout);
                    const link = document.getElementById('suppliersLink');
                    if (link) link.click();
                    keySequence = [];
                    document.removeEventListener('keydown', secondKeyHandler);
                } else if (e2.altKey && e2.key.toLowerCase() === 'r') {
                    // Alt+S+R - Sales Return
                    e2.preventDefault();
                    clearTimeout(sequenceTimeout);
                    const link = document.getElementById('salesReturnLink');
                    if (link) link.click();
                    keySequence = [];
                    document.removeEventListener('keydown', secondKeyHandler);
                } else {
                    document.removeEventListener('keydown', secondKeyHandler);
                }
            };
            document.addEventListener('keydown', secondKeyHandler);
            return;
        }
        
        // Alt + C - Customers
        if (e.altKey && e.key.toLowerCase() === 'c' && !e.ctrlKey) {
            e.preventDefault();
            const link = document.getElementById('customersLink');
            if (link) link.click();
            return;
        }
        
        // Alt + I - Stock Issues
        if (e.altKey && e.key.toLowerCase() === 'i' && !e.ctrlKey) {
            e.preventDefault();
            const link = document.getElementById('stockIssuesLink');
            if (link) link.click();
            return;
        }
        
        // Alt + P + R - Purchase Return (sequence)
        if (e.altKey && !e.ctrlKey) {
            keySequence.push(e.key.toLowerCase());
            clearTimeout(sequenceTimeout);
            
            sequenceTimeout = setTimeout(() => {
                keySequence = [];
            }, 1000);
            
            // Check for Alt+P+R sequence
            if (keySequence.length >= 2 && keySequence[keySequence.length-2] === 'p' && keySequence[keySequence.length-1] === 'r') {
                e.preventDefault();
                const link = document.getElementById('purchaseReturnLink');
                if (link) link.click();
                keySequence = [];
                return;
            }
        }
        
        // Ctrl + P + I/L/Y - Purchase shortcuts
        if (e.ctrlKey && e.key.toLowerCase() === 'p' && !e.altKey && !e.shiftKey) {
            e.preventDefault();
            keySequence = ['p'];
            clearTimeout(sequenceTimeout);
            
            sequenceTimeout = setTimeout(() => {
                keySequence = [];
            }, 1000);
            
            const nextKeyHandler = function(e2) {
                if (e2.key.toLowerCase() === 'i') {
                    e2.preventDefault();
                    const link = document.getElementById('newPurchaseInvoiceLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'l') {
                    e2.preventDefault();
                    const link = document.getElementById('purchaseInvoiceListLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'y') {
                    e2.preventDefault();
                    const link = document.getElementById('purchasePaymentLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else {
                    document.removeEventListener('keydown', nextKeyHandler);
                }
            };
            
            document.addEventListener('keydown', nextKeyHandler);
            return;
        }
        
        // Ctrl + S + I/L/Y - Sales shortcuts
        if (e.ctrlKey && e.key.toLowerCase() === 's' && !e.altKey && !e.shiftKey) {
            e.preventDefault();
            keySequence = ['s'];
            clearTimeout(sequenceTimeout);
            
            sequenceTimeout = setTimeout(() => {
                keySequence = [];
            }, 1000);
            
            const nextKeyHandler = function(e2) {
                if (e2.key.toLowerCase() === 'i') {
                    e2.preventDefault();
                    const link = document.getElementById('quickInvoiceLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'l') {
                    e2.preventDefault();
                    const link = document.getElementById('salesInvoiceListLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'y') {
                    e2.preventDefault();
                    const link = document.getElementById('salesReceiptLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else {
                    document.removeEventListener('keydown', nextKeyHandler);
                }
            };
            
            document.addEventListener('keydown', nextKeyHandler);
            return;
        }
        
        // Ctrl + I + P/A/B/D/S - Inventory shortcuts
        if (e.ctrlKey && e.key.toLowerCase() === 'i' && !e.altKey && !e.shiftKey) {
            e.preventDefault();
            keySequence = ['i'];
            clearTimeout(sequenceTimeout);
            
            sequenceTimeout = setTimeout(() => {
                keySequence = [];
            }, 1000);
            
            const nextKeyHandler = function(e2) {
                if (e2.key.toLowerCase() === 'p') {
                    e2.preventDefault();
                    const link = document.getElementById('productListLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'a') {
                    e2.preventDefault();
                    const link = document.getElementById('allInventoryLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'b') {
                    e2.preventDefault();
                    const link = document.getElementById('batchReportLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'd') {
                    e2.preventDefault();
                    const link = document.getElementById('dateReportLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 's') {
                    e2.preventDefault();
                    const link = document.getElementById('stockStatementLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else {
                    document.removeEventListener('keydown', nextKeyHandler);
                }
            };
            
            document.addEventListener('keydown', nextKeyHandler);
            return;
        }
        
        // Ctrl + A + D/U/P/B/C - Admin shortcuts
        if (e.ctrlKey && e.key.toLowerCase() === 'a' && !e.altKey && !e.shiftKey) {
            e.preventDefault();
            keySequence = ['a'];
            clearTimeout(sequenceTimeout);
            
            sequenceTimeout = setTimeout(() => {
                keySequence = [];
            }, 1000);
            
            const nextKeyHandler = function(e2) {
                if (e2.key.toLowerCase() === 'd') {
                    e2.preventDefault();
                    const link = document.getElementById('dashboardLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'u') {
                    e2.preventDefault();
                    const link = document.getElementById('addUserLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'p') {
                    e2.preventDefault();
                    const link = document.getElementById('pharmacyDetailsLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'b') {
                    e2.preventDefault();
                    const link = document.getElementById('backupLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else if (e2.key.toLowerCase() === 'c') {
                    e2.preventDefault();
                    const link = document.getElementById('contraEntryLink');
                    if (link) link.click();
                    document.removeEventListener('keydown', nextKeyHandler);
                } else {
                    document.removeEventListener('keydown', nextKeyHandler);
                }
            };
            
            document.addEventListener('keydown', nextKeyHandler);
            return;
        }
    });
</script>



