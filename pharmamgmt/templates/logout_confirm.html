<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Logout Confirmation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .dialog { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 400px; width: 90%; }
        .dialog-icon { text-align: center; font-size: 48px; color: #667eea; margin-bottom: 20px; }
        .dialog-title { font-size: 22px; font-weight: bold; text-align: center; margin-bottom: 15px; color: #333; }
        .dialog-message { font-size: 16px; text-align: center; margin-bottom: 25px; color: #666; line-height: 1.5; }
        .dialog-buttons { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-yes { background: #10b981; color: white; }
        .btn-yes:hover { background: #059669; transform: translateY(-2px); }
        .btn-no { background: #ef4444; color: white; }
        .btn-no:hover { background: #dc2626; transform: translateY(-2px); }
    </style>
</head>
<body>
    <div class="dialog">
        <div class="dialog-icon">ðŸ’¾</div>
        <div class="dialog-title">Create Database Backup?</div>
        <div class="dialog-message">Would you like to create and download a database backup before logging out?</div>
        <form method="POST" action="{% url 'logout' %}" id="logoutForm">
            {% csrf_token %}
            <div class="dialog-buttons">
                <button type="button" onclick="handleBackup()" class="btn btn-yes">Yes, Backup</button>
                <button type="submit" name="backup" value="no" class="btn btn-no">No, Logout</button>
            </div>
        </form>
    </div>
    <script>
        function handleBackup() {
            const form = document.getElementById('logoutForm');
            const formData = new FormData(form);
            formData.append('backup', 'yes');
            
            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const a = document.createElement('a');
                    a.href = data.backup_url;
                    a.download = '';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => {
                        window.location.href = '/login/';
                    }, 1000);
                }
            });
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'y' || e.key === 'Y') {
                handleBackup();
            } else if (e.key === 'n' || e.key === 'N') {
                document.querySelector('[value="no"]').click();
            }
        });
    </script>
</body>
</html>
