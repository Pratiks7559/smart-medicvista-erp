<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Customer Sales Report</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; font-size: 9px; padding: 10px; }
        .header { text-align: center; margin-bottom: 8px; border-bottom: 2px solid #000; padding-bottom: 5px; }
        .pharmacy-name { font-size: 14px; font-weight: bold; }
        .pharmacy-info { font-size: 8px; }
        .title { font-size: 12px; font-weight: bold; text-align: center; margin: 5px 0; }
        .info { font-size: 8px; margin-bottom: 8px; }
        .info-row { display: flex; }
        .info-label { font-weight: bold; width: 80px; }
        table { width: 100%; border-collapse: collapse; font-size: 8px; }
        th { background: #000; color: #fff; padding: 3px 2px; border: 1px solid #000; }
        td { padding: 2px; border: 1px solid #666; }
        tbody tr:nth-child(even) { background: #f5f5f5; }
        tfoot td { font-weight: bold; background: #e0e0e0; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .summary { margin-top: 8px; font-size: 9px; }
        .summary div { display: flex; justify-content: space-between; padding: 2px 0; }
        @media print { body { padding: 0; } @page { margin: 1cm; } }
    </style>
</head>
<body>
    <div class="header">
        {% if pharmacy %}<div class="pharmacy-name">{{ pharmacy.pharmaname|upper }}</div>
        <div class="pharmacy-info">{% if pharmacy.proprietorcontact %}{{ pharmacy.proprietorcontact }}{% endif %}{% if pharmacy.proprietoremail %} | {{ pharmacy.proprietoremail }}{% endif %}</div>{% endif %}
    </div>
    <div class="title">CUSTOMER SALES REPORT</div>
    <div class="info">
        <div class="info-row"><span class="info-label">Customer:</span> {{ customer.customer_name }} ({{ customer.customer_type|default:"N/A" }})</div>
        <div class="info-row"><span class="info-label">Period:</span> {{ from_date|date:"d/m/Y" }} to {{ to_date|date:"d/m/Y" }} | Generated: {% now "d/m/Y H:i" %}</div>
    </div>
    {% if sales_data or customer_challans %}
    <table>
        <thead>
            <tr>
                <th class="text-center">No</th>
                <th class="text-center">Type</th>
                <th>Inv/Chal</th>
                <th class="text-center">Date</th>
                <th>Product</th>
                <th class="text-center">Batch</th>
                <th class="text-right">Qty</th>
                <th class="text-right">Rate</th>
                <th class="text-right">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for sale_info in sales_data %}{% for item in sale_info.items %}
            <tr>
                <td class="text-center">{{ forloop.parentloop.counter }}.{{ forloop.counter }}</td>
                <td class="text-center">Inv</td>
                <td>{{ sale_info.invoice.sales_invoice_no }}</td>
                <td class="text-center">{{ sale_info.invoice.sales_invoice_date|date:"d/m/y" }}</td>
                <td>{{ item.product_name|truncatechars:25 }}</td>
                <td class="text-center">{{ item.product_batch_no|truncatechars:10 }}</td>
                <td class="text-right">{{ item.sale_quantity|floatformat:0 }}</td>
                <td class="text-right">{{ item.sale_rate|floatformat:0 }}</td>
                <td class="text-right">{{ item.sale_total_amount|floatformat:0 }}</td>
            </tr>
            {% endfor %}{% endfor %}
            {% for challan in customer_challans %}
            <tr>
                <td class="text-center">C{{ forloop.counter }}</td>
                <td class="text-center">Chal</td>
                <td>{{ challan.customer_challan_no }}</td>
                <td class="text-center">{{ challan.sales_entry_date|date:"d/m/y" }}</td>
                <td>{{ challan.product_name|truncatechars:25 }}</td>
                <td class="text-center">{{ challan.product_batch_no|truncatechars:10 }}</td>
                <td class="text-right">{{ challan.sale_quantity|floatformat:0 }}</td>
                <td class="text-right">{{ challan.sale_rate|floatformat:0 }}</td>
                <td class="text-right">{{ challan.sale_total_amount|floatformat:0 }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="6" class="text-right">TOTAL</td>
                <td class="text-right">{{ summary.total_qty|floatformat:0 }}</td>
                <td></td>
                <td class="text-right">â‚¹{{ summary.total_amount|floatformat:0 }}</td>
            </tr>
        </tfoot>
    </table>

    {% else %}
    <p style="text-align:center;padding:20px;">No data found</p>
    {% endif %}
    <script>window.onload=function(){window.print()};</script>
</body>
</html>
